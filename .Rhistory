coef(om3)
om3p <- polr(work ~sons + income, data=womenlf, method="probit")
summary(om3p)
predict(om3, newdata = data.frame(sons="present", income=14.75665), type = "probs")
predict(om3p, newdata = data.frame(sons="present", income=14.75665), type = "probs")
# Logit/probit which one to choose?
AIC(om3, om3p)
#Predict new obs sons-present income on mean
summary(om3p)
lpPT <- 0-0.5463 - (-1.19387) - (-0.03181*14.75665); lpPT
pnorm(lpNW); pnorm(lpPT)
#Predict new obs sons-present income on mean
summary(om3p)
lpNW <- 0-1.0867 - (-1.19387) - (-0.03181*14.75665); lpNW
lpPT <- 0-0.5463 - (-1.19387) - (-0.03181*14.75665); lpPT
pnorm(lpNW); pnorm(lpPT)
pnorm(lpNW); pnorm(lpPT)-pnorm(lpNW);1-pnorm(lpPT)
AIC(h1m3)+AIC(h2m3)# H1 + H2
AIC(mm3) # Nominal multinomial option
AIC(om3p) # Ordinal with probit
setwd("~/Desktop/MVA/Project/spotify_MVA")
#library of Association rules
library(arules)
df_wk_i <- readRDS("../preprocessing.Rdata")
df_wk_i <- readRDS("preprocessing.Rdata")
df_wk_i <- readRDS("report/preprocessing.Rdata")
df_wk_i %>% names()
#library of Association rules
library(arules)
library("arulesViz")
library(dplyr)
library("FactoMineR")
library("factoextra")
# We perform this analysis with all categorical columns we have currently.
df_cat <- df_wk_i %>%
select("Artist", "Track", "Album", "Key", "instrumental_band",
"speech_band", "Album_type",  "Licensed", "official_video", "genre", "time_signature",
"mode") %>%
mutate(across(everything(), as.factor))
# Convert the dataframe to a transactional dataset
df_trans <- as(df_cat, "transactions")
summary(df_trans)
inspect(head(df_trans,10)) #list top 10 transactions
itemFrequencyPlot(df_trans, topN=10, xlab="Top 10 Frequent Items")
itemFrequencyPlot(df_trans, topN=20, cex.names=0.8, xlab="Top 20 Frequent Items")
setwd("~/Desktop/SIM/Assignment_2/Telco_Customer_Churn")
library(car)
library(missMDA)
library(ggplot2)
library(FactoMineR)
library(chemometrics)
rm(list = ls())
customer_churn <- read.csv("WA_Fn-UseC_-Telco-Customer-Churn.csv")
par(mfrow = c(1, 1))
customer_churn$gender <- as.factor(customer_churn$gender)
customer_churn$SeniorCitizen <- factor(
customer_churn$SeniorCitizen,
labels = c("No", "Yes")
)
customer_churn$Partner <- as.factor(customer_churn$Partner)
customer_churn$Dependents <- as.factor(customer_churn$Dependents)
customer_churn$PhoneService <- as.factor(customer_churn$PhoneService)
customer_churn$MultipleLines <- as.factor(customer_churn$MultipleLines)
customer_churn$InternetService <- as.factor(customer_churn$InternetService)
customer_churn$OnlineSecurity <- as.factor(customer_churn$OnlineSecurity)
customer_churn$OnlineBackup <- as.factor(customer_churn$OnlineBackup)
customer_churn$DeviceProtection <- as.factor(customer_churn$DeviceProtection)
customer_churn$TechSupport <- as.factor(customer_churn$TechSupport)
customer_churn$StreamingTV <- as.factor(customer_churn$StreamingTV)
customer_churn$StreamingMovies <- as.factor(customer_churn$StreamingMovies)
customer_churn$Contract <- as.factor(customer_churn$Contract)
customer_churn$PaperlessBilling <- as.factor(customer_churn$PaperlessBilling)
customer_churn$PaymentMethod <- as.factor(customer_churn$PaymentMethod)
customer_churn$Churn <- as.factor(customer_churn$Churn)
customer_churn$f.MonthlyCharges <- cut(
customer_churn$MonthlyCharges,
breaks = quantile(
customer_churn$MonthlyCharges,
probs = c(0, 0.25, 0.5, 0.75, 1)
),
labels = c("Low", "Medium", "High", "Very high"),
include.lowest = TRUE
)
customer_churn$f.tenure <- cut(
customer_churn$tenure,
breaks = quantile(
customer_churn$tenure,
probs = c(0, 0.25, 0.5, 0.75, 1)
),
labels = c("Very short", "Short", "Long", "Very long"),
include.lowest = TRUE
)
# Chunk 1
library(car)
library(missMDA)
library(ggplot2)
library(FactoMineR)
library(chemometrics)
rm(list = ls())
customer_churn <- read.csv("WA_Fn-UseC_-Telco-Customer-Churn.csv")
par(mfrow = c(1, 1))
# Chunk 2
customer_churn$gender <- as.factor(customer_churn$gender)
customer_churn$SeniorCitizen <- factor(
customer_churn$SeniorCitizen,
labels = c("No", "Yes")
)
customer_churn$Partner <- as.factor(customer_churn$Partner)
customer_churn$Dependents <- as.factor(customer_churn$Dependents)
customer_churn$PhoneService <- as.factor(customer_churn$PhoneService)
customer_churn$MultipleLines <- as.factor(customer_churn$MultipleLines)
customer_churn$InternetService <- as.factor(customer_churn$InternetService)
customer_churn$OnlineSecurity <- as.factor(customer_churn$OnlineSecurity)
customer_churn$OnlineBackup <- as.factor(customer_churn$OnlineBackup)
customer_churn$DeviceProtection <- as.factor(customer_churn$DeviceProtection)
customer_churn$TechSupport <- as.factor(customer_churn$TechSupport)
customer_churn$StreamingTV <- as.factor(customer_churn$StreamingTV)
customer_churn$StreamingMovies <- as.factor(customer_churn$StreamingMovies)
customer_churn$Contract <- as.factor(customer_churn$Contract)
customer_churn$PaperlessBilling <- as.factor(customer_churn$PaperlessBilling)
customer_churn$PaymentMethod <- as.factor(customer_churn$PaymentMethod)
customer_churn$Churn <- as.factor(customer_churn$Churn)
# Chunk 3
customer_churn$f.MonthlyCharges <- cut(
customer_churn$MonthlyCharges,
breaks = quantile(
customer_churn$MonthlyCharges,
probs = c(0, 0.25, 0.5, 0.75, 1)
),
labels = c("Low", "Medium", "High", "Very high"),
include.lowest = TRUE
)
customer_churn$f.tenure <- cut(
customer_churn$tenure,
breaks = quantile(
customer_churn$tenure,
probs = c(0, 0.25, 0.5, 0.75, 1)
),
labels = c("Very short", "Short", "Long", "Very long"),
include.lowest = TRUE
)
# Chunk 4
prop.table(table(customer_churn$gender))
# Missing values
sum(is.na(customer_churn$gender))
# Chunk 5
prop.table(table(customer_churn$SeniorCitizen))
# Missing values
sum(is.na(customer_churn$SeniorCitizen))
# Chunk 6
prop.table(table(customer_churn$Partner))
# Missing values
sum(is.na(customer_churn$Partner))
# Chunk 7
prop.table(table(customer_churn$Dependents))
# Missing values
sum(is.na(customer_churn$Dependents))
# Chunk 8
# Missing values
sum(is.na(customer_churn$tenure))
# Univariant Outliers
length(Boxplot(customer_churn$tenure, id = list(n = Inf)))
# Chunk 9
prop.table(table(customer_churn$PhoneService))
# Missing values
sum(is.na(customer_churn$PhoneService))
# Chunk 10
prop.table(table(customer_churn$MultipleLines))
# Missing values
sum(is.na(customer_churn$MultipleLines))
# Chunk 11
prop.table(table(customer_churn$InternetService))
# Missing values
sum(is.na(customer_churn$InternetService))
# Chunk 12
prop.table(table(customer_churn$OnlineSecurity))
# Missing values
sum(is.na(customer_churn$OnlineSecurity))
# Chunk 13
prop.table(table(customer_churn$OnlineBackup))
# Missing values
sum(is.na(customer_churn$OnlineBackup))
# Chunk 14
prop.table(table(customer_churn$DeviceProtection))
# Missing values
sum(is.na(customer_churn$DeviceProtection))
# Chunk 15
prop.table(table(customer_churn$TechSupport))
# Missing values
sum(is.na(customer_churn$TechSupport))
# Chunk 16
prop.table(table(customer_churn$StreamingTV))
# Missing values
sum(is.na(customer_churn$StreamingTV))
# Chunk 17
prop.table(table(customer_churn$StreamingMovies))
# Missing values
sum(is.na(customer_churn$StreamingMovies))
# Chunk 18
prop.table(table(customer_churn$Contract))
# Missing values
sum(is.na(customer_churn$Contract))
# Chunk 19
prop.table(table(customer_churn$PaperlessBilling))
# Missing values
sum(is.na(customer_churn$PaperlessBilling))
# Chunk 20
prop.table(table(customer_churn$PaymentMethod))
# Missing values
sum(is.na(customer_churn$PaymentMethod))
# Chunk 21
# Missing values
sum(is.na(customer_churn$MonthlyCharges))
# Univariant Outliers
length(Boxplot(customer_churn$MonthlyCharges, id = list(n = Inf)))
# Chunk 22
# Missing values
sum(is.na(customer_churn$TotalCharges))
ll_na <- which(is.na(customer_churn$TotalCharges))
customer_churn[ll_na,]
customer_churn$TotalCharges[ll_na] = 0
# Univariant Outliers
length(Boxplot(customer_churn$TotalCharges, id = list(n = Inf)))
customer_churn$f.TotalCharges <- cut(
customer_churn$TotalCharges,
breaks = quantile(
customer_churn$TotalCharges,
probs = c(0, 0.25, 0.5, 0.75, 1)
),
labels = c("Low", "Medium", "High", "Very high"),
include.lowest = TRUE
)
# Chunk 23
prop.table(table(customer_churn$Churn))
# Missing values
sum(is.na(customer_churn$Churn))
# Phone Service
sum(customer_churn$PhoneService == "No")
sum(customer_churn$PhoneService == "No" | customer_churn$MultipleLines == "No internet service")
# Internet Service
sum(customer_churn$InternetService == "No")
sum(customer_churn$InternetService == "No" | customer_churn$OnlineSecurity == "No internet service" | customer_churn$OnlineBackup == "No internet service" | customer_churn$DeviceProtection == "No internet service" | customer_churn$TechSupport == "No internet service" | customer_churn$StreamingTV == "No internet service" | customer_churn$StreamingMovies == "No internet service")
res.out <- Moutlier(customer_churn[, c(6,19,20)], quantile = 0.98, col = "blue")
#which((res.out$md > res.out$cutoff) & (res.out$rd > res.out$cutoff))
length(which((res.out$md > res.out$cutoff) & (res.out$rd > res.out$cutoff))) / 7043
par(mfrow = c(1, 1))
plot(res.out$md, res.out$rd)
abline(h = res.out$cutoff, col = "red")
abline(v = res.out$cutoff, col = "red")
# summary(house_prices[which((res.out$md > res.out$cutoff) & (res.out$rd > res.out$cutoff)), ])
# summary(house_prices)
customer_churn <- customer_churn[-which((res.out$md > res.out$cutoff) & (res.out$rd > res.out$cutoff)), ]
set.seed(123)
train_index <- sample(
seq_len(nrow(customer_churn)),
size = floor(0.8 * nrow(customer_churn))
)
customer_churn_test <- customer_churn[-train_index, ]
customer_churn <- customer_churn[train_index, ]
library(ggplot2)
ggplot(customer_churn, aes(x = tenure)) +
geom_histogram(bins = 20) +
labs(x = "Tenure (months)", y = "Count", title = "Histogram of tenure")
ggplot(customer_churn, aes(x = Churn, y = MonthlyCharges)) +
geom_boxplot() +
labs(
x = "Churn",
y = "Monthly charges($)",
title = "Boxplot of monthly charges by churn"
)
ggplot(customer_churn, aes(x = Contract, fill = Churn)) +
geom_bar(position = "dodge") +
labs(
x = "Contract type",
y = "Count",
title = "Barplot of contract type by churn"
)
ggplot(
customer_churn,
aes(
x = TotalCharges,
y = MonthlyCharges,
color = Churn
)
) +
geom_point() +
labs(
x = "Total charges ($)",
y = "Monthly charges ($)",
title = "Scatterplot of total and monthly charges by churn"
)
catdes(customer_churn, num.var = 21)
cor(customer_churn[, c("tenure", "MonthlyCharges")])
chisq.test(customer_churn$gender, customer_churn$Churn)
# Chunk 1
library(car)
library(missMDA)
library(ggplot2)
library(FactoMineR)
library(chemometrics)
rm(list = ls())
customer_churn <- read.csv("WA_Fn-UseC_-Telco-Customer-Churn.csv")
par(mfrow = c(1, 1))
# Chunk 2
customer_churn$gender <- as.factor(customer_churn$gender)
customer_churn$SeniorCitizen <- factor(
customer_churn$SeniorCitizen,
labels = c("No", "Yes")
)
customer_churn$Partner <- as.factor(customer_churn$Partner)
customer_churn$Dependents <- as.factor(customer_churn$Dependents)
customer_churn$PhoneService <- as.factor(customer_churn$PhoneService)
customer_churn$MultipleLines <- as.factor(customer_churn$MultipleLines)
customer_churn$InternetService <- as.factor(customer_churn$InternetService)
customer_churn$OnlineSecurity <- as.factor(customer_churn$OnlineSecurity)
customer_churn$OnlineBackup <- as.factor(customer_churn$OnlineBackup)
customer_churn$DeviceProtection <- as.factor(customer_churn$DeviceProtection)
customer_churn$TechSupport <- as.factor(customer_churn$TechSupport)
customer_churn$StreamingTV <- as.factor(customer_churn$StreamingTV)
customer_churn$StreamingMovies <- as.factor(customer_churn$StreamingMovies)
customer_churn$Contract <- as.factor(customer_churn$Contract)
customer_churn$PaperlessBilling <- as.factor(customer_churn$PaperlessBilling)
customer_churn$PaymentMethod <- as.factor(customer_churn$PaymentMethod)
customer_churn$Churn <- as.factor(customer_churn$Churn)
# Chunk 3
customer_churn$f.MonthlyCharges <- cut(
customer_churn$MonthlyCharges,
breaks = quantile(
customer_churn$MonthlyCharges,
probs = c(0, 0.25, 0.5, 0.75, 1)
),
labels = c("Low", "Medium", "High", "Very high"),
include.lowest = TRUE
)
customer_churn$f.tenure <- cut(
customer_churn$tenure,
breaks = quantile(
customer_churn$tenure,
probs = c(0, 0.25, 0.5, 0.75, 1)
),
labels = c("Very short", "Short", "Long", "Very long"),
include.lowest = TRUE
)
# Chunk 4
prop.table(table(customer_churn$gender))
# Missing values
sum(is.na(customer_churn$gender))
# Chunk 5
prop.table(table(customer_churn$SeniorCitizen))
# Missing values
sum(is.na(customer_churn$SeniorCitizen))
# Chunk 6
prop.table(table(customer_churn$Partner))
# Missing values
sum(is.na(customer_churn$Partner))
# Chunk 7
prop.table(table(customer_churn$Dependents))
# Missing values
sum(is.na(customer_churn$Dependents))
# Chunk 8
# Missing values
sum(is.na(customer_churn$tenure))
# Univariant Outliers
length(Boxplot(customer_churn$tenure, id = list(n = Inf)))
# Chunk 9
prop.table(table(customer_churn$PhoneService))
# Missing values
sum(is.na(customer_churn$PhoneService))
# Chunk 10
prop.table(table(customer_churn$MultipleLines))
# Missing values
sum(is.na(customer_churn$MultipleLines))
# Chunk 11
prop.table(table(customer_churn$InternetService))
# Missing values
sum(is.na(customer_churn$InternetService))
# Chunk 12
prop.table(table(customer_churn$OnlineSecurity))
# Missing values
sum(is.na(customer_churn$OnlineSecurity))
# Chunk 13
prop.table(table(customer_churn$OnlineBackup))
# Missing values
sum(is.na(customer_churn$OnlineBackup))
# Chunk 14
prop.table(table(customer_churn$DeviceProtection))
# Missing values
sum(is.na(customer_churn$DeviceProtection))
# Chunk 15
prop.table(table(customer_churn$TechSupport))
# Missing values
sum(is.na(customer_churn$TechSupport))
# Chunk 16
prop.table(table(customer_churn$StreamingTV))
# Missing values
sum(is.na(customer_churn$StreamingTV))
# Chunk 17
prop.table(table(customer_churn$StreamingMovies))
# Missing values
sum(is.na(customer_churn$StreamingMovies))
# Chunk 18
prop.table(table(customer_churn$Contract))
# Missing values
sum(is.na(customer_churn$Contract))
# Chunk 19
prop.table(table(customer_churn$PaperlessBilling))
# Missing values
sum(is.na(customer_churn$PaperlessBilling))
# Chunk 20
prop.table(table(customer_churn$PaymentMethod))
# Missing values
sum(is.na(customer_churn$PaymentMethod))
# Chunk 21
# Missing values
sum(is.na(customer_churn$MonthlyCharges))
# Univariant Outliers
length(Boxplot(customer_churn$MonthlyCharges, id = list(n = Inf)))
# Chunk 22
# Missing values
sum(is.na(customer_churn$TotalCharges))
ll_na <- which(is.na(customer_churn$TotalCharges))
customer_churn[ll_na,]
customer_churn$TotalCharges[ll_na] = 0
# Univariant Outliers
length(Boxplot(customer_churn$TotalCharges, id = list(n = Inf)))
customer_churn$f.TotalCharges <- cut(
customer_churn$TotalCharges,
breaks = quantile(
customer_churn$TotalCharges,
probs = c(0, 0.25, 0.5, 0.75, 1)
),
labels = c("Low", "Medium", "High", "Very high"),
include.lowest = TRUE
)
# Chunk 23
prop.table(table(customer_churn$Churn))
# Missing values
sum(is.na(customer_churn$Churn))
# Chunk 24
# Phone Service
sum(customer_churn$PhoneService == "No")
sum(customer_churn$PhoneService == "No" | customer_churn$MultipleLines == "No internet service")
# Internet Service
sum(customer_churn$InternetService == "No")
sum(customer_churn$InternetService == "No" | customer_churn$OnlineSecurity == "No internet service" | customer_churn$OnlineBackup == "No internet service" | customer_churn$DeviceProtection == "No internet service" | customer_churn$TechSupport == "No internet service" | customer_churn$StreamingTV == "No internet service" | customer_churn$StreamingMovies == "No internet service")
# Chunk 25
res.out <- Moutlier(customer_churn[, c(6,19,20)], quantile = 0.98, col = "blue")
#which((res.out$md > res.out$cutoff) & (res.out$rd > res.out$cutoff))
length(which((res.out$md > res.out$cutoff) & (res.out$rd > res.out$cutoff))) / 7043
par(mfrow = c(1, 1))
plot(res.out$md, res.out$rd)
abline(h = res.out$cutoff, col = "red")
abline(v = res.out$cutoff, col = "red")
# summary(house_prices[which((res.out$md > res.out$cutoff) & (res.out$rd > res.out$cutoff)), ])
# summary(house_prices)
customer_churn <- customer_churn[-which((res.out$md > res.out$cutoff) & (res.out$rd > res.out$cutoff)), ]
# Chunk 26
set.seed(123)
train_index <- sample(
seq_len(nrow(customer_churn)),
size = floor(0.8 * nrow(customer_churn))
)
customer_churn_test <- customer_churn[-train_index, ]
customer_churn <- customer_churn[train_index, ]
# Chunk 27
library(ggplot2)
ggplot(customer_churn, aes(x = tenure)) +
geom_histogram(bins = 20) +
labs(x = "Tenure (months)", y = "Count", title = "Histogram of tenure")
# Chunk 28
ggplot(customer_churn, aes(x = Churn, y = MonthlyCharges)) +
geom_boxplot() +
labs(
x = "Churn",
y = "Monthly charges($)",
title = "Boxplot of monthly charges by churn"
)
# Chunk 29
ggplot(customer_churn, aes(x = Contract, fill = Churn)) +
geom_bar(position = "dodge") +
labs(
x = "Contract type",
y = "Count",
title = "Barplot of contract type by churn"
)
# Chunk 30
ggplot(
customer_churn,
aes(
x = TotalCharges,
y = MonthlyCharges,
color = Churn
)
) +
geom_point() +
labs(
x = "Total charges ($)",
y = "Monthly charges ($)",
title = "Scatterplot of total and monthly charges by churn"
)
# Chunk 31
cor(customer_churn[, c("tenure", "MonthlyCharges")])
# Chunk 32
chisq.test(customer_churn$gender, customer_churn$Churn)
# Chunk 33
catdes(customer_churn, num.var = 21)
hist(
customer_churn$TotalCharges,
main = "Histogram of Total Charges",
xlab = "Total Charges",
col = "lightblue"
)
